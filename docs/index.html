<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>위클리 커밋 챌린지</title>
    <link rel="stylesheet" href="styles.css">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1><span class="emoji">🔥</span> <span class="title-text">위클리 커밋 챌린지</span></h1>
            <p class="subtitle">꾸준히 커밋하는 습관을 기록하고 추적해보세요!</p>
            <div class="current-challenge">
                <span class="challenge-badge" id="currentChallenge">
                    <span class="badge-icon">📅</span>
                    <span class="badge-text"></span>
                </span>
                <p class="challenge-info">지금 참여하면 이번 주부터 기록이 시작됩니다</p>


            </div>
        </header>

        <!-- 스티키 도전 메시지 -->
        <div class="challenge-provocative">🤔 생각보다 쉽지 않을 걸요? 매주 커밋할 자신 있나요?</div>

        <section class="stats">
            <div class="stat-card">
                <h3>총 참여자</h3>
                <p class="stat-number" id="totalParticipants">-</p>
            </div>
            <div class="stat-card">
                <h3>이번 주 성공</h3>
                <p class="stat-number" id="weeklySuccessful">-</p>
            </div>
            <div class="stat-card">
                <h3>평균 성공률</h3>
                <p class="stat-number" id="averageSuccessRate">-</p>
            </div>
            <div class="stat-card">
                <h3>평균 연속 성공</h3>
                <p class="stat-number" id="averageStreak">-</p>
            </div>
        </section>



        <section class="ranking">
            <h2>🏅 참여자 랭킹</h2>
            <div class="ranking-filters">
                <button class="filter-btn active" data-filter="streak">연속 도전 중</button>
                <button class="filter-btn" data-filter="success-rate">성공률</button>
                <button class="filter-btn" data-filter="max-streak">최고 연속 기록</button>
                <button class="filter-btn" data-filter="commits">이번 주 커밋 수</button>
            </div>
            <div id="rankingList" class="ranking-list">
                <div class="loading">랭킹을 불러오는 중...</div>
            </div>
        </section>

        <section class="my-profile">
            <h2>👤 내 참여 현황</h2>
            <div class="profile-search">
                <div class="search-container">
                    <input type="text" id="profileInput" placeholder="GitHub 사용자명 또는 프로필 URL 입력" />
                    <button id="searchProfile" class="search-btn">🔍 조회</button>
                </div>
                <p class="search-hint">예: tlqhrm 또는 https://github.com/tlqhrm</p>
            </div>

            <div id="profileResult" class="profile-result" style="display: none;">
                <!-- 프로필 내용이 동적으로 여기에 추가됩니다 -->
            </div>
        </section>


        <section class="how-to">
            <h2>📝 참여 방법</h2>
            <div class="steps-vertical">
                <div class="step-vertical">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <h3>이 레포지토리 Fork 하기</h3>
                    </div>
                    <p>GitHub에서 이 레포지토리를 Fork하여 본인 계정으로 복사하세요.</p>
                    <a href="https://github.com/tlqhrm/weekly-commit-challenge/fork" target="_blank" class="fork-btn">⚡ Fork Repository</a>
                </div>

                <div class="step-vertical">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <h3>GitHub Actions 활성화</h3>
                    </div>
                    <p>Fork한 레포지토리의 Actions 탭에서 워크플로우를 활성화하세요.</p>
                    <p class="step-example">Repository → Actions → "I understand my workflows, go ahead and enable them"</p>
                    <div class="workflow-enable-guide">
                        <h4>📸 워크플로우 활성화 가이드</h4>
                        <div class="guide-images">
                            <div class="guide-step">
                                <h5>1단계: Actions 활성화 허용</h5>
                                <img src="./images/allow-action.png" alt="GitHub Actions 활성화 허용" class="guide-image clickable-image" onclick="openImageModal('./images/allow-action.png', 'GitHub Actions 활성화 허용')">
                                <p class="guide-description">"I understand my workflows, go ahead and enable them" 버튼을 클릭하여 Actions를 허용하세요.</p>
                            </div>
                            <div class="guide-step">
                                <h5>2단계: 워크플로우 활성화</h5>
                                <img src="./images/enable-action.png" alt="워크플로우 활성화 버튼 클릭" class="guide-image clickable-image" onclick="openImageModal('./images/enable-action.png', '워크플로우 활성화 버튼 클릭')">
                                <p class="guide-description">"Weekly Commit Tracker" 워크플로우의 "Enable workflow" 버튼을 클릭하여 활성화하세요.</p>
                            </div>
                            <div class="guide-step">
                                <h5>3단계: 수동 실행 (선택사항)</h5>
                                <img src="./images/manual-run.png" alt="수동 워크플로우 실행" class="guide-image clickable-image" onclick="openImageModal('./images/manual-run.png', '수동 워크플로우 실행')" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <p class="missing-image" style="display: none; color: #8b949e; font-style: italic; padding: 20px; border: 1px dashed #30363d; border-radius: 4px; text-align: center;">manual-run.png 이미지가 필요합니다</p>
                                <p class="guide-description">즉시 기록을 시작하려면 "Run workflow" 버튼을 클릭하여 수동으로 실행하세요.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="step-vertical">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <h3>일주일에 한 번 커밋하기!</h3>
                    </div>
                    <p>매시간 정각에 자동으로 실행되어 지난 일주일간의 커밋을 체크하고 기록합니다.</p>
                    <p class="step-highlight">✅ 일주일에 한 번만 커밋해도 성공 기록!</p>
                    <p class="step-highlight">📋 record.md에 참여 내역이 테이블로 누적됩니다</p>
                    <div class="challenge-motivation">
                        <p class="motivation-text">💪 "매주 한 번쯤은 커밋할 수 있지 뭐" 라고 생각하시나요?</p>
                        <p class="motivation-text">⏰ 실제로는 2주만 지나도 깜빡하기 쉬워요!</p>
                        <p class="motivation-text">🎯 진짜 개발자라면 꾸준함을 증명해보세요!</p>
                    </div>
                    <div class="record-info">
                        <h4>📝 참여 기록 예시</h4>
                        <table class="example-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>기간</th>
                                    <th>주차</th>
                                    <th>커밋 수</th>
                                    <th>성공 여부</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>06/23 ~ 06/29</td>
                                    <td>2025년 25주차</td>
                                    <td>5</td>
                                    <td>✅ 성공</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>06/30 ~ 07/06</td>
                                    <td>2025년 26주차</td>
                                    <td>3</td>
                                    <td>✅ 성공</td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>07/07 ~ 07/13</td>
                                    <td>2025년 27주차</td>
                                    <td>0</td>
                                    <td>❌ 실패</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            </div>
        </section>

        <section class="how-to">
            <h2>⚙️ 워크플로우 작동 방식</h2>
            <div class="steps-vertical">
                <div class="step-vertical">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <h3>실행 주기</h3>
                    </div>
                    <p><strong>매시간 정각</strong> 자동 실행</p>
                    <p class="step-example">수동 실행 가능: GitHub Actions → "Run workflow"</p>
                </div>

                <div class="step-vertical">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <h3>Fork 사용자 초기화</h3>
                    </div>
                    <p>Fork 후 첫 실행시 <strong>자동으로 개인 기록 초기화</strong></p>
                    <p class="step-example">원본 사용자 데이터가 자동으로 삭제되고 새로운 기록 시작</p>
                    <p class="step-highlight">✅ 깨끗한 새 테이블로 시작</p>
                </div>

                <div class="step-vertical">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <h3>커밋 집계 및 기록</h3>
                    </div>
                    <p>본인 계정의 <strong>공개 레포지토리만</strong> 수집</p>
                    <div class="record-info">
                        <h4>📋 집계 규칙</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li>✅ 본인 계정의 공개 레포지토리</li>
                            <li>❌ weekly-commit-challenge 레포지토리는 제외</li>
                            <li>❌ 봇이 작성한 커밋은 제외 (dependabot, renovate 등)</li>
                        </ul>
                    </div>
                </div>

            </div>
        </section>

        <section class="how-to">
            <h2>🎨 README에 카드 추가하기</h2>
            <div class="steps-vertical">
                <div class="step-vertical">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <h3>코드 복사하기</h3>
                    </div>
                    <p>GitHub 프로필 README에 실시간으로 업데이트되는 카드를 추가해보세요</p>
                    <div class="import-url">
                        <input type="text" readonly value="![Weekly Commit Challenge](https://weekly-commit-card.wjstls123.workers.dev/?username=YOUR_USERNAME)" id="embedding-example">
                        <button onclick="copyToClipboard('embedding-example')">복사</button>
                    </div>
                    <p class="step-example">YOUR_USERNAME을 본인의 GitHub 사용자명으로 변경하세요</p>
                </div>

                <div class="step-vertical">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <h3>결과 확인</h3>
                    </div>
                    <p>README에 추가하면 다음과 같은 카드가 표시됩니다</p>
                    <div style="text-align: center; margin: 20px 0;">
                        <img src="https://weekly-commit-card.wjstls123.workers.dev/?username=tlqhrm"
                             alt="Weekly Commit Challenge Card Example"
                             style="border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 100%;">
                    </div>
                </div>
            </div>
        </section>


    </div>

    <!-- 이미지 모달 -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-button" onclick="closeImageModal()">&times;</span>
            <img id="modalImage" src="" alt="">
            <div class="modal-caption" id="modalCaption"></div>
        </div>
    </div>

    <script>
        function copyToClipboard(elementId) {
            const inputElement = document.getElementById(elementId);
            if (inputElement) {
                const text = inputElement.value;
                navigator.clipboard.writeText(text).then(() => {
                    alert('코드가 복사되었습니다! YOUR_USERNAME을 본인의 GitHub 사용자명으로 바꿔주세요.');
                });
            } else {
                // 기본 텍스트 (호환성용)
                const text = "![Weekly Commit Challenge](https://weekly-commit-card.wjstls123.workers.dev/?username=YOUR_USERNAME)";
                navigator.clipboard.writeText(text).then(() => {
                    alert('코드가 복사되었습니다! YOUR_USERNAME을 본인의 GitHub 사용자명으로 바꿔주세요.');
                });
            }
        }

        function openImageModal(imageSrc, caption) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');

            modal.style.display = 'flex';
            modalImage.src = imageSrc;
            modalCaption.textContent = caption;

            // 페이지 스크롤 방지
            document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';

            // 페이지 스크롤 복원
            document.body.style.overflow = 'auto';
        }

        // ESC 키로 모달 닫기
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeImageModal();
            }
        });

        // 스티키 메시지 효과
        function initStickyChallenge() {
            const challengeElement = document.querySelector('.challenge-provocative');
            if (!challengeElement) return;

            const challengeOffset = challengeElement.offsetTop;
            let isSticky = false;

            function handleScroll() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

                if (scrollTop > challengeOffset && !isSticky) {
                    // 스티키 모드 활성화
                    challengeElement.classList.add('sticky-mode');
                    isSticky = true;
                    console.log('스티키 모드 활성화');
                } else if (scrollTop <= challengeOffset && isSticky) {
                    // 스티키 모드 비활성화
                    challengeElement.classList.remove('sticky-mode');
                    isSticky = false;
                    console.log('스티키 모드 비활성화');
                }
            }

            // 스크롤 이벤트 리스너 추가 (스로틀링 적용)
            let ticking = false;
            window.addEventListener('scroll', function() {
                if (!ticking) {
                    requestAnimationFrame(function() {
                        handleScroll();
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        }

        // 페이지 로드 시 스티키 효과 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initStickyChallenge();
        });
    </script>
    <script src="script.js"></script>
</body>
</html>
